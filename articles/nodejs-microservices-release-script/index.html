<!doctype html><html><head><title></title><meta name=title content="Fat codes"><meta name=description content="Personal Blog about software engineering, microservices and distributed systems"><meta property="og:type" content="website"><meta property="og:url" content="https://www.fat.codes/"><meta property="og:title" content="Fat codes"><meta property="og:description" content="Personal Blog about software engineering, microservices and distributed systems"><meta property="og:image" content="https://pbs.twimg.com/profile_images/977527947509760001/snSo28Ed_400x400.jpg"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://www.fat.codes/"><meta property="twitter:title" content="Fat codes"><meta property="twitter:description" content="Personal Blog about software engineering, microservices and distributed systems"><meta property="twitter:image" content="https://pbs.twimg.com/profile_images/977527947509760001/snSo28Ed_400x400.jpg"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-22994628-9"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-22994628-9');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css integrity=sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Ubuntu|Ubuntu+Mono" rel=stylesheet><title>Nodejs Microservices Release Script</title><link rel=stylesheet href=/css/stylesheet.css></head><body><div class=container-fluid><nav class="navbar navbar-expand-md navbar-light"><span class="navbar-brand mb-0 h1"></span><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNavAltMarkup aria-controls=navbarNav aria-expanded=false aria-label="Toggle Navigation" name=button>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavAltMarkup><div class=navbar-nav><a class="nav-item nav-link" href=/>Home</a>
<a class="nav-item nav-link" href=https://github.com/fatmatto target=_blank>GitHub</a>
<a class="nav-item nav-link" href=https://gitlab.com/fatmatto target=_blank>GitLab</a>
<a class="nav-item nav-link" href=/about/>About</a></div></div></nav><section id=page-title><h1><a href=/>Fat Codes</a></h1><span id=author-name><h6>Software engineering related ramblings by <a href=/about/ class=link>fat</a></h6></span></section><div class=blog-post><h1 class=blog-post-title><span>Nodejs Microservices Release Script</span></h1><div class=blog-post-subheader><time>09 Feb 2019</time></div><div class=blog-post-content><p>At <a href=https://www.apio.cc>Apio</a>, we take &ldquo;not so smart objects&rdquo; such as a meter, a switch, or any other kind of device, and we turn it into a super device, able to communicate through internet with our infrastructure and, eventually, join the &ldquo;March of the Machines&rdquo; against humanity.</p><p>Jokes aside, to turn anything like a meter measurement into actionable data (alerts, analytics, commands to other devices) we need to process data in several steps.</p><p>Our development team&rsquo;s lingua franca is Javascript, and the vast majority of our microservices are HTTPS based NodeJS programs, often talking to a MongoDB database and to other peers microservices through HTTPS or Nats.</p><p>We are not a very large team at the moment, we surely have more microservices than members, so it&rsquo;s very important to keep things small, separated, easy to understand, to fix and to operate. For this reason we encapsulate every piece of functionality into a nodejs microservice. To keep track of which version of a microservice is deployed in which environment we use npm version numbers: we set the microservice version number both as a git tag and as package.json version field, then our typical &ldquo;GET /&rdquo; route for every microservice would print something like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
<span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Apio Analytics Service API&#34;</span>,
<span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;This is the HTTPs api for interacting with Apio Analytics&#34;</span>,
<span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;2.1.3&#34;</span>
}
</code></pre></div><p>In this way we can easily track which version is deployed where with a single HTTP request. A release version is useful for a number of reasons, some of which are:</p><ul><li>Api versioning</li><li>Add information to Jaeger traces</li><li>Add version to sentry errors</li><li>Notify other team members that your service has some major changes so you increase the major version number (X.y.z)</li></ul><p>Handling this version by hand can be tedious, and if you forget to do it, you lsot precious information. So I made this script that we are happily using for each of our nodejs project:</p></div></div><div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"fat-codes"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><footer><hr><small>&copy; 2020 fat.
Powered by <a href=https://gohugo.io/ target=_blank>Hugo</a>.</small></footer></div><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js integrity=sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T crossorigin=anonymous></script></body></html>